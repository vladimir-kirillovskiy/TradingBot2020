from visualization.candlestick import get_last_ATR, get_dataframe, get_last_price
import alpaca_trade_api as tradeapi

# аргументом функции является название акции


def risk(action, stock):
    if action == 'Buy':
        return risk_buy(stock)
    elif action == 'Sell' :
        return risk_sell(stock)
    elif action == 'Skip' :
        pass
     else :
        return 'error, action must be buy or sell'
        
def delete_all_positions():
    api.close_all_positions()
        
def risk_buy(stock):
    account = api.get_account()
    money_on_account = account.last_equity
    df, time = get_dataframe(stock, 100)
    atr = get_last_ATR(df)
    price = get_last_price(df, 'c')
    percent_risk=0.05
    stop = price - 2 * atr
    risk=price - stop
    if risk<=money_on_account*percent_risk:
        onePercentFromTotal = money_on_account*0.01
        return stop, onePercentFromTotal / (2*atr)    #сколько акций мы можем себе позволить, учитывая стоп лосс
      


def risk_sell(stock):
    account = api.get_account()
    money_on_account = account.last_equity
    df, time = get_dataframe(stock, 100)
    atr = get_last_ATR(df)
    price = get_last_price(df, 'c')
    stop = price + 2 * atr
    risk=price - stop
    percent_risk=0.05
    if risk<=money_on_account*percent_risk:
        onePercentFromTotal = money_on_account*0.01
        return stop, onePercentFromTotal / (2*atr)    #сколько акций мы можем себе позволить, учитывая стоп лосс
